<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Storyteller's Journey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-title {
            font-size: 2.5rem;
            color: #ffffff;
            font-weight: 700;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
            margin-bottom: 10px;
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-size: 1.1rem;
            color: rgba(255,255,255,0.9);
            font-weight: 400;
        }

        .book-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 32px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 20px auto;
            max-width: 900px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .book-pages {
            background: transparent;
            border-radius: 0;
            padding: 0;
            min-height: 500px;
            border: none;
        }

        .chapter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .chapter-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.08);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .chapter-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .chapter-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
            filter: grayscale(0.3);
        }

        .chapter-card.unlocked {
            border-color: #10b981;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        .chapter-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: #667eea;
            margin-bottom: 12px;
        }

        .chapter-title {
            font-size: 1rem;
            color: #374151;
            margin-bottom: 16px;
            font-weight: 500;
        }

        .chapter-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .chapter-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .chapter-button:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        .story-illustration {
            width: 100%;
            max-width: 400px;
            height: 200px;
            margin: 0 auto 24px;
            border-radius: 16px;
            border: 2px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #6b7280;
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            position: relative;
            overflow: hidden;
        }

        /* Modern Illustrated Backgrounds */
        .story-illustration.chapter-1 {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            position: relative;
        }

        .story-illustration.chapter-1::before {
            content: '';
            position: absolute;
            width: 60px;
            height: 60px;
            background: #8b4513;
            border-radius: 30px 30px 0 0;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 20px rgba(139, 69, 19, 0.3);
        }

        .story-illustration.chapter-1::after {
            content: '🎒';
            position: absolute;
            font-size: 2rem;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .story-illustration.chapter-2 {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            position: relative;
        }

        .story-illustration.chapter-2::before {
            content: '';
            position: absolute;
            width: 200px;
            height: 4px;
            background: linear-gradient(90deg, #ffd700, #ffeb3b, #ffd700);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 2px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; box-shadow: 0 0 25px rgba(255, 215, 0, 0.8); }
        }

        .story-illustration.chapter-3 {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
        }

        .story-illustration.chapter-3::before {
            content: '';
            position: absolute;
            width: 80px;
            height: 120px;
            background: linear-gradient(180deg, #228b22 0%, #006400 100%);
            border-radius: 40px 40px 0 0;
            top: 40%;
            left: 30%;
            transform: translate(-50%, -50%);
        }

        .story-illustration.chapter-3::after {
            content: '';
            position: absolute;
            width: 60px;
            height: 100px;
            background: linear-gradient(180deg, #228b22 0%, #006400 100%);
            border-radius: 30px 30px 0 0;
            top: 45%;
            left: 70%;
            transform: translate(-50%, -50%);
        }

        .story-illustration.chapter-4 {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            position: relative;
            overflow: hidden;
        }

        .story-illustration.chapter-4::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 20px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
            top: 60%;
            animation: wave 3s infinite;
        }

        @keyframes wave {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        .story-illustration.chapter-5 {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            position: relative;
        }

        .story-illustration.chapter-5::before {
            content: '💎';
            position: absolute;
            font-size: 3rem;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: sparkle 2s infinite;
        }

        @keyframes sparkle {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); filter: brightness(1.5); }
        }

        .story-text {
            font-size: 1.2rem;
            line-height: 1.7;
            color: #374151;
            margin: 24px 0;
            text-align: left;
        }

        .minigame-title {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 16px;
            text-align: center;
            font-weight: 700;
        }

        .minigame-instructions {
            font-size: 1.1rem;
            color: #6b7280;
            margin-bottom: 32px;
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }

        .minigame-area {
            min-height: 300px;
            background: white;
            border-radius: 16px;
            padding: 24px;
            border: 1px solid #e5e7eb;
            margin: 24px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
            color: white;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            transform: translateY(-2px);
        }

        .success-message {
            display: none;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border: 2px solid #10b981;
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
            font-size: 1.2rem;
            color: #065f46;
            font-weight: 600;
            text-align: center;
            animation: celebration 0.6s ease-out;
        }

        @keyframes celebration {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Backpack Creator */
        .backpack-preview {
            width: 200px;
            height: 250px;
            border: 3px solid #8b4513;
            border-radius: 15px;
            margin: 20px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%);
            position: relative;
            box-shadow: 0 8px 20px rgba(139, 69, 19, 0.3);
        }

        .backpack-preview::before {
            content: '';
            position: absolute;
            width: 160px;
            height: 180px;
            background: linear-gradient(135deg, #654321 0%, #8b4513 100%);
            border-radius: 12px;
            top: 20px;
            border: 2px solid #5d4037;
        }

        .backpack-items {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }

        .gear-option {
            width: 80px;
            height: 80px;
            border: 2px solid #667eea;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .gear-option:hover {
            transform: scale(1.1);
            border-color: #10b981;
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.2);
        }

        .gear-option.selected {
            border-color: #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            transform: scale(1.05);
        }

        .gear-label {
            font-size: 0.7rem;
            color: #374151;
            margin-top: 4px;
            font-weight: 500;
        }

        /* Pattern Game */
        .pattern-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            max-width: 400px;
            margin: 0 auto 20px;
        }

        .pattern-item {
            width: 60px;
            height: 60px;
            border: 2px solid #667eea;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }

        .pattern-item:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .pattern-item.correct {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-color: #10b981;
        }

        .pattern-choices {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        /* Sound Game */
        .sound-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .sound-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .sound-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            max-width: 400px;
            margin: 0 auto;
        }

        .sound-option {
            padding: 20px;
            border: 3px solid #667eea;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            text-align: center;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .sound-option:hover {
            transform: translateY(-3px);
            border-color: #10b981;
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.2);
        }

        .sound-option.correct {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-color: #10b981;
        }

        /* Number Game */
        .number-stones {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            max-width: 500px;
            margin: 20px auto;
        }

        .number-stone {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
            color: white;
            font-size: 1.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .number-stone:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .number-stone.clicked {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transform: scale(0.9);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        .progress-text {
            text-align: center;
            margin-top: 20px;
            font-size: 1.2rem;
            color: #374151;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .game-title {
                font-size: 2rem;
            }
            
            .chapter-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .backpack-items {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .control-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-header">
            <h1 class="game-title">The Storyteller's Journey</h1>
            <p class="subtitle">Complete mini-games to unlock your adventure story!</p>
        </div>

        <div class="book-container">
            <div class="book-pages">
                <!-- Main Book View -->
                <div id="main-view" class="view active">
                    <h2 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">Your Adventure Book</h2>
                    <div class="chapter-grid" id="chapter-grid">
                        <!-- Chapters will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Story Reading View -->
                <div id="story-view" class="view">
                    <div id="story-illustration" class="story-illustration">📖 Story Illustration</div>
                    <div id="story-text" class="story-text"></div>
                    <div class="control-buttons">
                        <button class="btn btn-secondary" onclick="Game.showMainView()">Back to Book</button>
                        <button class="btn btn-primary" onclick="Game.readStoryAloud()">🔊 Read Aloud</button>
                    </div>
                </div>

                <!-- Mini-Game View -->
                <div id="minigame-view" class="view">
                    <h2 id="minigame-title" class="minigame-title"></h2>
                    <div id="minigame-instructions" class="minigame-instructions"></div>
                    <div id="minigame-area" class="minigame-area"></div>
                    <div id="success-message" class="success-message">
                        🎉 Congratulations! You unlocked the next chapter! 🎉
                    </div>
                    <div class="control-buttons">
                        <button class="btn btn-secondary" onclick="Game.showMainView()">Back to Book</button>
                        <button id="complete-button" class="btn btn-success" onclick="Game.completeChapter()" style="display: none;">Complete Chapter</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const Game = {
            state: {
                unlockedChapters: [1],
                currentChapter: 1,
                backpack: {
                    compass: false,
                    rope: false,
                    flashlight: false,
                    map: false,
                    food: false,
                    water: false
                },
                minigameComplete: false,
                clickedNumbers: []
            },

            stories: {
                1: {
                    title: "The Brave Little Explorer",
                    illustration: "chapter-1",
                    text: "Once upon a time, there was a brave little explorer who loved adventures. With a sturdy backpack filled with essential gear, our hero discovered a mysterious, glimmering map tucked away in an old oak tree. The ancient map seemed to sparkle with magic, showing a winding path through enchanted lands filled with wonderful discoveries and exciting challenges waiting to be conquered."
                },
                2: {
                    title: "Following the Golden Path",
                    illustration: "chapter-2",
                    text: "Following the magical map, our brave explorer walked along a shimmering golden path that wound through meadows of rainbow flowers. The path seemed to glow with each step, leading through rolling hills covered in soft, emerald grass. As the sun began to set, painting the sky in brilliant oranges and purples, the explorer could see mysterious dark woods ahead, where strange and wonderful sounds echoed through the towering trees."
                },
                3: {
                    title: "Whispers in the Enchanted Forest",
                    illustration: "chapter-3",
                    text: "Entering the whispering woods, our explorer heard many mysterious sounds - wise owls hooting their ancient songs, leaves rustling with secrets, and gentle animal calls echoing through the forest. Though a little nervous, our brave hero remembered that most forest creatures are friendly and curious. By listening carefully and showing kindness, the explorer made friends with the woodland animals, who eagerly pointed toward a beautiful sparkling river that flowed like liquid starlight through the trees."
                },
                4: {
                    title: "The Magical River Crossing",
                    illustration: "chapter-4",
                    text: "At the sparkling river, our explorer discovered magical stepping stones with glowing numbers carved into their surface. The friendly forest animals explained that the stones would only appear in the right order, creating a bridge of pure light. By carefully stepping on each numbered stone from 1 to 10, a magnificent bridge of shimmering light appeared across the water! On the far shore, the explorer spotted the entrance to a mysterious cave that glowed with warm, welcoming light and seemed to hum with ancient magic."
                },
                5: {
                    title: "The Treasure of Wisdom",
                    illustration: "chapter-5",
                    text: "Inside the magical cave, our explorer discovered the most breathtaking sight - walls covered with sparkling gemstones of every color imaginable, each one glowing with its own inner light! By carefully collecting the special gems and solving the cave's ancient puzzle, a secret door opened to reveal the greatest treasure of all: a magical book that would forever remember this incredible adventure. Happy and proud, our brave explorer headed home, knowing that the greatest adventures come from courage, kindness, and curiosity about the wonderful world around us."
                }
            },

            minigames: {
                1: {
                    title: "Explorer's Backpack",
                    instructions: "Pack your backpack for the adventure! Choose the essential gear you'll need for exploring.",
                    type: "backpack"
                },
                2: {
                    title: "Pattern Path Finder",
                    instructions: "Complete the pattern to help the hero find the right path! What comes next?",
                    type: "pattern"
                },
                3: {
                    title: "Forest Sound Detective",
                    instructions: "Listen to the forest sound and identify what creature makes it!",
                    type: "sound"
                },
                4: {
                    title: "Magic Stone Bridge",
                    instructions: "Click the numbered stones in order from 1 to 10 to build the magical bridge!",
                    type: "number"
                },
                5: {
                    title: "Gemstone Collector",
                    instructions: "Find and collect all the magical gemstones hidden in the treasure cave! Find at least 5 gems to unlock the final treasure.",
                    type: "gemstone"
                }
            },

            init: function() {
                this.renderChapterGrid();
                console.log("Game initialized successfully");
            },

            showView: function(viewId) {
                const views = document.querySelectorAll('.view');
                views.forEach(view => view.classList.remove('active'));
                document.getElementById(viewId).classList.add('active');
            },

            showMainView: function() {
                this.showView('main-view');
                this.renderChapterGrid();
            },

            showStoryView: function(chapter) {
                this.showView('story-view');
                this.loadStory(chapter);
            },

            showMinigameView: function() {
                this.showView('minigame-view');
            },

            renderChapterGrid: function() {
                const grid = document.getElementById('chapter-grid');
                grid.innerHTML = '';

                for (let i = 1; i <= 5; i++) {
                    const isUnlocked = this.state.unlockedChapters.includes(i);
                    const canPlay = isUnlocked && i === Math.max(...this.state.unlockedChapters);
                    const canRead = this.state.unlockedChapters.includes(i) && i < Math.max(...this.state.unlockedChapters);
                    
                    const completedFinalGame = i === 5 && this.state.unlockedChapters.includes(5) && this.state.currentChapter === 5 && this.state.minigameComplete;
                    
                    const card = document.createElement('div');
                    card.className = `chapter-card ${isUnlocked ? 'unlocked' : 'locked'}`;
                    card.dataset.chapter = i;
                    
                    let buttonText = '🔒 Locked';
                    let buttonAction = '';
                    let buttonDisabled = true;
                    
                    if (completedFinalGame || (i === 5 && canRead)) {
                        buttonText = 'Read Final Chapter';
                        buttonAction = `onclick="Game.showStoryView(${i})"`;
                        buttonDisabled = false;
                    } else if (canPlay) {
                        buttonText = 'Play Mini-Game';
                        buttonAction = `onclick="Game.startMinigame(${i})"`;
                        buttonDisabled = false;
                    } else if (canRead) {
                        buttonText = 'Read Chapter';
                        buttonAction = `onclick="Game.showStoryView(${i})"`;
                        buttonDisabled = false;
                    }
                    
                    card.innerHTML = `
                        <div class="chapter-number">${i}</div>
                        <div class="chapter-title">${this.stories[i].title}</div>
                        <button class="chapter-button" ${buttonAction} ${buttonDisabled ? 'disabled' : ''}>${buttonText}</button>
                    `;
                    
                    grid.appendChild(card);
                }
            },

            loadStory: function(chapter) {
                const story = this.stories[chapter];
                const illustration = document.getElementById('story-illustration');
                illustration.className = `story-illustration ${story.illustration}`;
                illustration.textContent = '';
                document.getElementById('story-text').textContent = story.text;
            },

            readStoryAloud: function() {
                const text = document.getElementById('story-text').textContent;
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.8;
                    utterance.pitch = 1.1;
                    speechSynthesis.speak(utterance);
                } else {
                    alert("Story reading is not supported in your browser, but you can read along!");
                }
            },

            startMinigame: function(chapter) {
                this.state.currentChapter = chapter;
                this.state.minigameComplete = false;
                this.state.clickedNumbers = [];
                
                const minigame = this.minigames[chapter];
                document.getElementById('minigame-title').textContent = minigame.title;
                document.getElementById('minigame-instructions').textContent = minigame.instructions;
                document.getElementById('success-message').style.display = 'none';
                document.getElementById('complete-button').style.display = 'none';
                
                this.showMinigameView();
                this.loadMinigame(minigame.type);
            },

            loadMinigame: function(type) {
                const area = document.getElementById('minigame-area');
                area.innerHTML = '';
                
                switch(type) {
                    case 'backpack':
                        this.loadBackpackGame(area);
                        break;
                    case 'pattern':
                        this.loadPatternGame(area);
                        break;
                    case 'sound':
                        this.loadSoundGame(area);
                        break;
                    case 'number':
                        this.loadNumberGame(area);
                        break;
                    case 'gemstone':
                        this.loadGemstoneGame(area);
                        break;
                }
            },

            loadBackpackGame: function(area) {
                area.innerHTML = `
                    <div class="backpack-preview" id="backpack-preview">
                        <div class="backpack-items" id="selected-items">
                            <!-- Selected items will appear here -->
                        </div>
                    </div>
                    <h3 style="text-align: center; margin-bottom: 15px; color: #374151; font-weight: 600;">Choose Your Explorer Gear:</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 15px; max-width: 600px; margin: 0 auto;">
                        <div class="gear-option" onclick="Game.selectGear('compass', '🧭', this)">
                            🧭
                            <div class="gear-label">Compass</div>
                        </div>
                        <div class="gear-option" onclick="Game.selectGear('rope', '🪢', this)">
                            🪢
                            <div class="gear-label">Rope</div>
                        </div>
                        <div class="gear-option" onclick="Game.selectGear('flashlight', '🔦', this)">
                            🔦
                            <div class="gear-label">Flashlight</div>
                        </div>
                        <div class="gear-option" onclick="Game.selectGear('map', '🗺️', this)">
                            🗺️
                            <div class="gear-label">Map</div>
                        </div>
                        <div class="gear-option" onclick="Game.selectGear('food', '🥪', this)">
                            🥪
                            <div class="gear-label">Food</div>
                        </div>
                        <div class="gear-option" onclick="Game.selectGear('water', '💧', this)">
                            💧
                            <div class="gear-label">Water</div>
                        </div>
                        <div class="gear-option" onclick="Game.selectGear('firstaid', '🩹', this)">
                            🩹
                            <div class="gear-label">First Aid</div>
                        </div>
                        <div class="gear-option" onclick="Game.selectGear('binoculars', '🔭', this)">
                            🔭
                            <div class="gear-label">Binoculars</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px; color: #6b7280; font-size: 0.95rem;">
                        Select at least 3 items to pack your backpack!
                    </div>
                `;
                
                this.state.selectedGear = 0;
            },

            selectGear: function(gearType, emoji, element) {
                if (!element.classList.contains('selected')) {
                    element.classList.add('selected');
                    this.state.backpack[gearType] = true;
                    this.state.selectedGear = (this.state.selectedGear || 0) + 1;
                    
                    const selectedItems = document.getElementById('selected-items');
                    const gearItem = document.createElement('div');
                    gearItem.style.cssText = `
                        font-size: 1.5rem;
                        background: rgba(255,255,255,0.9);
                        border-radius: 8px;
                        padding: 8px;
                        margin: 4px;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                        border: 1px solid #e5e7eb;
                    `;
                    gearItem.textContent = emoji;
                    selectedItems.appendChild(gearItem);
                    
                    if (this.state.selectedGear >= 3) {
                        setTimeout(() => {
                            this.completeMinigame();
                        }, 1000);
                    }
                }
            },

            loadPatternGame: function(area) {
                area.innerHTML = `
                    <div class="pattern-grid">
                        <div class="pattern-item">🍎</div>
                        <div class="pattern-item">🍌</div>
                        <div class="pattern-item">🍎</div>
                        <div class="pattern-item">🍌</div>
                        <div class="pattern-item" id="pattern-answer">?</div>
                    </div>
                    <h3 style="text-align: center; color: #374151; margin-bottom: 20px;">What comes next in the pattern?</h3>
                    <div class="pattern-choices">
                        <div class="pattern-item" onclick="Game.selectPattern('🍎')">🍎</div>
                        <div class="pattern-item" onclick="Game.selectPattern('🍌')">🍌</div>
                        <div class="pattern-item" onclick="Game.selectPattern('🍊')">🍊</div>
                    </div>
                `;
            },

            selectPattern: function(choice) {
                const answerElement = document.getElementById('pattern-answer');
                if (choice === '🍎') {
                    answerElement.textContent = '🍎';
                    answerElement.classList.add('correct');
                    this.completeMinigame();
                } else {
                    alert("Try again! Look at the pattern: 🍎🍌🍎🍌... what comes next?");
                }
            },

            loadSoundGame: function(area) {
                area.innerHTML = `
                    <div style="text-align: center;">
                        <button class="sound-button" onclick="Game.playSound()">🔊 Play Forest Sound</button>
                        <div class="sound-options">
                            <div class="sound-option" onclick="Game.selectSound('owl')">
                                🦉<br><strong>Wise Owl</strong><br><em>"Hoo-hoo"</em>
                            </div>
                            <div class="sound-option" onclick="Game.selectSound('bird')">
                                🐦<br><strong>Song Bird</strong><br><em>"Tweet-tweet"</em>
                            </div>
                            <div class="sound-option" onclick="Game.selectSound('leaves')">
                                🍃<br><strong>Rustling Leaves</strong><br><em>"Whoosh"</em>
                            </div>
                            <div class="sound-option" onclick="Game.selectSound('water')">
                                💧<br><strong>Flowing Water</strong><br><em>"Babble-splash"</em>
                            </div>
                        </div>
                    </div>
                `;
            },

            playSound: function() {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance("Hoo hoo");
                    utterance.rate = 0.5;
                    utterance.pitch = 0.8;
                    speechSynthesis.speak(utterance);
                }
                
                const button = document.querySelector('.sound-button');
                const originalText = button.innerHTML;
                button.innerHTML = "🦉 Hoo-hoo!";
                button.style.background = "linear-gradient(135deg, #10b981 0%, #059669 100%)";
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";
                }, 2000);
            },

            selectSound: function(choice) {
                if (choice === 'owl') {
                    const owlOption = document.querySelector('[onclick="Game.selectSound(\'owl\')"]');
                    owlOption.classList.add('correct');
                    this.completeMinigame();
                } else {
                    alert("That's not quite right. Listen again and think about what makes a 'hoo-hoo' sound!");
                }
            },

            loadNumberGame: function(area) {
                const numbers = [3, 1, 5, 2, 8, 4, 7, 6, 10, 9];
                this.state.clickedNumbers = [];
                
                area.innerHTML = `
                    <div class="number-stones">
                        ${numbers.map(num => 
                            `<button class="number-stone" onclick="Game.clickNumber(${num}, this)">${num}</button>`
                        ).join('')}
                    </div>
                    <div class="progress-text" id="number-progress">
                        Click the magic stones in order: 1, 2, 3... to build your bridge!
                    </div>
                `;
            },

            clickNumber: function(num, element) {
                const expectedNumber = this.state.clickedNumbers.length + 1;
                
                if (num === expectedNumber) {
                    this.state.clickedNumbers.push(num);
                    element.classList.add('clicked');
                    element.disabled = true;
                    
                    const progressElement = document.getElementById('number-progress');
                    if (this.state.clickedNumbers.length === 10) {
                        progressElement.innerHTML = '<span style="color: #10b981; font-weight: 600;">🌉 Perfect! The magical bridge appears!</span>';
                        this.completeMinigame();
                    } else {
                        progressElement.innerHTML = `<span style="color: #667eea;">Excellent! Next stone: <strong>${this.state.clickedNumbers.length + 1}</strong></span>`;
                    }
                } else {
                    alert(`Look for the magic stone with number ${expectedNumber}!`);
                }
            },

            loadGemstoneGame: function(area) {
                const gems = [
                    { emoji: '💎', name: 'Diamond', color: '#e5e7eb' },
                    { emoji: '💍', name: 'Golden Ring', color: '#fbbf24' },
                    { emoji: '🔮', name: 'Crystal Ball', color: '#8b5cf6' },
                    { emoji: '💚', name: 'Emerald Heart', color: '#10b981' },
                    { emoji: '💙', name: 'Sapphire Heart', color: '#3b82f6' },
                    { emoji: '💜', name: 'Amethyst Heart', color: '#8b5cf6' },
                    { emoji: '❤️', name: 'Ruby Heart', color: '#ef4444' },
                    { emoji: '🧿', name: 'Mystic Eye', color: '#06b6d4' }
                ];
                
                area.innerHTML = `
                    <div style="text-align: center; margin-bottom: 24px;">
                        <h3 style="color: #374151; font-size: 1.4rem; margin-bottom: 12px; font-weight: 600;">✨ Enchanted Treasure Cave ✨</h3>
                        <p style="color: #6b7280; font-size: 1rem;">Discover the magical gems hidden within the ancient cave!</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px; margin-bottom: 24px;">
                        ${gems.map((gem) => `
                            <div class="gem-card" 
                                 style="background: linear-gradient(135deg, ${gem.color}15 0%, ${gem.color}08 100%); 
                                        border: 2px solid ${gem.color}60; 
                                        border-radius: 16px; 
                                        padding: 20px; 
                                        text-align: center; 
                                        cursor: pointer; 
                                        transition: all 0.3s ease;
                                        transform: scale(1);
                                        box-shadow: 0 6px 20px ${gem.color}25;"
                                 onclick="Game.collectGem(this, '${gem.emoji}', '${gem.name}')"
                                 data-gem="${gem.emoji}">
                                <div style="font-size: 2.5rem; margin-bottom: 12px;">${gem.emoji}</div>
                                <div style="font-size: 0.9rem; color: #374151; font-weight: 600;">${gem.name}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="progress-bar" style="background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); border-radius: 12px; height: 12px; margin-bottom: 16px; border: 1px solid #d1d5db; overflow: hidden;">
                        <div id="gem-progress-bar" style="background: linear-gradient(90deg, #10b981, #34d399, #6ee7b7); height: 100%; border-radius: 11px; width: 0%; transition: width 0.8s ease;"></div>
                    </div>
                    
                    <div class="progress-text" id="gem-progress" style="text-align: center; font-size: 1.1rem; color: #374151; font-weight: 500;">
                        Collect at least 5 magical gems to unlock the ancient treasure! (0/5 found)
                    </div>
                `;
                
                this.state.gemsCollected = 0;
            },

            collectGem: function(element, gem, name) {
                if (!element.classList.contains('collected')) {
                    element.classList.add('collected');
                    element.style.pointerEvents = 'none';
                    element.style.opacity = '0.7';
                    element.style.transform = 'scale(0.95)';
                    
                    this.state.gemsCollected = (this.state.gemsCollected || 0) + 1;
                    
                    const progressBar = document.getElementById('gem-progress-bar');
                    const progressPercent = (this.state.gemsCollected / 8) * 100;
                    progressBar.style.width = progressPercent + '%';
                    
                    const progressElement = document.getElementById('gem-progress');
                    if (this.state.gemsCollected >= 5) {
                        progressElement.innerHTML = `
                            <div style="color: #10b981; font-weight: 700; font-size: 1.2rem; margin-bottom: 8px;">🎉 Incredible! You discovered ${this.state.gemsCollected} magical gems! 🎉</div>
                            <div style="color: #6b7280; font-size: 1rem;">The ancient treasure chest glows with mystical energy!</div>
                        `;
                        setTimeout(() => {
                            this.completeMinigame();
                        }, 2000);
                    } else {
                        progressElement.innerHTML = `
                            <div style="color: #667eea; font-weight: 600; margin-bottom: 4px;">✨ Wonderful! You found the ${name}! ✨</div>
                            <div style="color: #6b7280;">Seek ${5 - this.state.gemsCollected} more gems to unlock the treasure (${this.state.gemsCollected}/5 discovered)</div>
                        `;
                    }
                }
            },

            completeMinigame: function() {
                this.state.minigameComplete = true;
                document.getElementById('success-message').style.display = 'block';
                document.getElementById('complete-button').style.display = 'inline-block';
            },

            completeChapter: function() {
                const nextChapter = this.state.currentChapter + 1;
                if (nextChapter <= 5) {
                    this.state.unlockedChapters.push(nextChapter);
                }
                
                setTimeout(() => {
                    if (this.state.currentChapter === 5) {
                        if (confirm("🎉 Congratulations! You've completed the entire magical adventure! 🎉\n\nWould you like to read the final chapter?")) {
                            this.showStoryView(5);
                        } else {
                            this.showMainView();
                        }
                    } else {
                        if (confirm(`🌟 Amazing work! You've unlocked Chapter ${nextChapter}! 🌟\n\nWould you like to read the story you just unlocked?`)) {
                            this.showStoryView(this.state.currentChapter);
                        } else {
                            this.showMainView();
                        }
                    }
                }, 1500);
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            Game.init();
            console.log("Enhanced Explorer Game ready to play!");
        });
    </script>
</body>
</html>
